å®Œæ•´è³‡è¨Šåœ¨ https://github.com/squirrel1209/TAIFEXPacketParser.git

# ğŸ§  TAIFEXPacketProject

TAIFEXPacketProject æ˜¯ä¸€å€‹å°ˆç‚ºå°ç£æœŸäº¤æ‰€ï¼ˆTAIFEXï¼‰å°åŒ…æ ¼å¼æ‰€æ‰“é€ çš„é«˜æ•ˆèƒ½å°åŒ…è§£æç³»çµ±ã€‚å°ˆæ¡ˆå…·æœ‰æ¨¡çµ„åŒ–çµæ§‹ï¼Œæ”¯æ´å¤šæ ¼å¼ï¼ˆå¦‚ I020ã€I012ã€I080ã€I010ï¼‰è§£æã€è¨˜æ†¶é«”å…§è³‡æ–™åº«ç®¡ç†ã€ä»¥åŠå¯æ“´å±•çš„æŸ¥è©¢èˆ‡è¼¸å‡ºä»‹é¢ï¼Œé©åˆç”¨æ–¼å¸‚å ´è³‡æ–™ç›£æ§ã€äº¤æ˜“ç³»çµ±å‰è™•ç†ç­‰æ‡‰ç”¨å ´æ™¯ã€‚


## âœ… åŠŸèƒ½é …ç›®ç¸½è¦½

| åŠŸèƒ½                     | èªªæ˜                                           |
|--------------------------|------------------------------------------------|
| å³æ™‚æŸ¥çœ‹æ’®åˆæˆäº¤è³‡è¨Š     | å¾ I020 å–å¾—å•†å“ã€åƒ¹æ ¼ã€æ•¸é‡ã€æ™‚é–“            |
| æŸ¥çœ‹å•†å“æ¼²è·Œåœå€é–“       | å¾ I012 å¾—çŸ¥å•†å“çš„ä¸Šä¸‹é™åƒ¹æ ¼                  |
| æŸ¥è©¢å§”è¨—ç°¿æ·±åº¦          | å¾ I080 é¡¯ç¤ºäº”æª”è²·è³£åƒ¹æ ¼èˆ‡æ•¸é‡                |
| é¡¯ç¤ºå•†å“åŸºæœ¬è³‡æ–™          | å¾ I010 å–å¾—å•†å“åç¨±èˆ‡äº¤å‰²æœˆä»½                |
| æ¢ä»¶æŸ¥è©¢                | å¯ä¾å•†å“ä»£ç¢¼ã€æ™‚é–“å€é–“æŸ¥è©¢ç‰¹å®šè³‡æ–™            |
| è¼¸å‡ºå ±è¡¨                | åŒ¯å‡ºæŸ¥è©¢çµæœç‚º JSON / CSVï¼Œä¾›ç³»çµ±å¾ŒçºŒåˆ†æ     |
---

## ğŸ“œ è³‡æ–™è¡¨ (ä½¿ç”¨ `unordered_map` å„²å­˜å®¹å™¨)

### 1. `MatchInfo`ï¼ˆæ’¥åˆè³‡è¨Šï¼šI020ï¼‰

> å„²å­˜æ–¼ï¼š
> `std::unordered_map<std::string, std::vector<MatchInfo>> matchInfoMap;`
> ğŸ” å¯ä¾ `productId` å¿«é€ŸæŸ¥æ‰¾æ¯å€‹å•†å“çš„æ­·å²æ’¥åˆç´€éŒ„

| æ¬„ä½åç¨±        | å‹æ…‹     | èªªæ˜           |
| ----------- | ------ | ------------ |
| productId   | string | å•†å“ä»£ç¢¼         |
| matchTime   | int    | æˆäº¤æ™‚é–“ï¼ˆHHMMSSï¼‰ |
| matchPrice  | double | æˆäº¤åƒ¹æ ¼         |
| matchVolume | int    | æˆäº¤æ•¸é‡ï¼ˆå£æ•¸ï¼‰     |
| buySellFlag | char   | è²·è³£æ–¹å‘ï¼ˆB/Sï¼‰    |

---

### 2. `PriceBandInfo`ï¼ˆæ¼²è·Œåœè³‡è¨Šï¼šI012ï¼‰

> å„²å­˜æ–¼ï¼š
> `std::unordered_map<std::string, std::vector<PriceBandInfo>> priceBandMap;`
> ğŸ” å¯ä¾å•†å“ä»£ç¢¼æŸ¥æ‰¾æ¯å€‹æ™‚é–“é»çš„å¤šéšæ¼²è·Œåœå€é–“è¨­å®š

| æ¬„ä½åç¨±       | å‹æ…‹     | èªªæ˜         |
| ---------- | ------ | ---------- |
| productId  | string | å•†å“ä»£ç¢¼       |
| limitLevel | int    | éšæ•¸ï¼ˆç¬¬å¹¾å±¤æ¼²è·Œåœï¼‰ |
| raiseLimit | double | æ¼²åœåƒ¹æ ¼       |
| fallLimit  | double | è·Œåœåƒ¹æ ¼       |

---

### 3. `OrderBookInfo`ï¼ˆäº”æ¨“è³‡è¨Šï¼šI080ï¼‰

> å„²å­˜æ–¼ï¼š
> `std::unordered_map<std::string, std::vector<OrderBookInfo>> orderBookMap;`
> ğŸ” å¯ä¾å•†å“ä»£ç¢¼è¿½è¹¤æ™‚é–“åºåˆ—çš„è²·è³£æ›å–®è®ŠåŒ–

| æ¬„ä½åç¨±          | å‹æ…‹        | èªªæ˜   |
| ------------- | --------- | ---- |
| productId     | string    | å•†å“ä»£ç¢¼ |
| updateTime    | int       | è³‡æ–™æ™‚é–“ |
| bidPrice\[5]  | double\[] | äº”æ¨“è²·åƒ¹ |
| bidVolume\[5] | int\[]    | äº”æ¨“è²·é‡ |
| askPrice\[5]  | double\[] | äº”æ¨“è³£åƒ¹ |
| askVolume\[5] | int\[]    | äº”æ¨“è³£é‡ |

---

### 4. `ProductInfo`ï¼ˆå•†å“åŸºæœ¬è³‡è¨Šï¼šI010ï¼‰

> å„²å­˜æ–¼ï¼š
> `std::unordered_map<std::string, ProductInfo> productInfoMap;`
> ğŸ” å¯ç›´æ¥æŸ¥è©¢ç‰¹å®šå•†å“çš„åç¨±èˆ‡äº¤å‰²æœˆä»½ï¼ˆéœæ…‹è³‡æ–™ï¼‰

| æ¬„ä½åç¨±          | å‹æ…‹     | èªªæ˜   |
| ------------- | ------ | ---- |
| productId     | string | å•†å“ä»£ç¢¼ |
| productName   | string | å•†å“åç¨± |
| deliveryMonth | string | äº¤å‰²æœˆä»½ |



## ğŸ§© UML æ¨¡çµ„é—œè¯åœ–ï¼ˆå¯¦é«”åœ–ï¼‰

![æ¨¡çµ„ç‰©ä»¶åœ–](system_diagram.png)

---

## ğŸ”„ è³‡æ–™è™•ç†æµç¨‹åœ–

![è³‡æ–™è™•ç†æµç¨‹åœ–](data_flowchart.png)

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹ç¸½è¦½

```
TAIFEXPacketProject/
â”œâ”€â”€ CMakeLists.txt              # ğŸ”§ CMake å»ºç½®è¨­å®š
â”œâ”€â”€ data/                       # ğŸ“‚ æ¸¬è©¦ç”¨äºŒé€²ä½å°åŒ…æª”
â”œâ”€â”€ include/                    # ğŸ“ æ‰€æœ‰æ¨™é ­æª” (.h)
â”‚   â”œâ”€â”€ base/                   # ğŸŒ± æŠ½è±¡é¡åˆ¥èˆ‡ä»‹é¢
â”‚   â”œâ”€â”€ common/                 # ğŸ”§ å›ºå®šé•·åº¦çµæ§‹å·¥å…·
â”‚   â”œâ”€â”€ protocol/               # ğŸ§¾ å°åŒ…é€šç”¨æ¬„ä½ï¼ˆHeaderï¼‰
â”‚   â”œâ”€â”€ controller/             # ğŸ® ä¸»è§£ææµç¨‹æ§åˆ¶
â”‚   â”œâ”€â”€ dispatcher/             # ğŸ“¨ å°åŒ…åˆ†ç™¼é‚è¼¯
â”‚   â”œâ”€â”€ parser/                 # ğŸ§© å„æ ¼å¼ payload è§£æå™¨
â”‚   â”œâ”€â”€ data/                   # ğŸ“Š å°åŒ…è³‡æ–™çµæ§‹ï¼ˆå°è£ header + bodyï¼‰
â”‚   â”œâ”€â”€ storage/                # ğŸ’¾ è¨˜æ†¶é«”å…§è³‡æ–™åº«
â”‚   â”œâ”€â”€ output/                 # ğŸ–¨ï¸ çµæœè¼¸å‡ºï¼ˆJSON / CSVï¼‰
â”‚   â”œâ”€â”€ query/                  # ğŸ” æŸ¥è©¢æ¨¡çµ„ï¼ˆä¾› API/GUI ä½¿ç”¨ï¼‰
â”‚   â””â”€â”€ state/                  # ğŸ” å³æ™‚ç‹€æ…‹è¿½è¹¤æ¨¡çµ„
â”œâ”€â”€ src/                        # ğŸ“‚ å°æ‡‰ .cpp æª”æ¡ˆ
â””â”€â”€ main.cpp                    # ğŸ§ª æ¸¬è©¦æ•´åˆä¸»ç¨‹å¼
```

---

## ğŸ”§ åŠŸèƒ½æ¨¡çµ„èªªæ˜

| æ¨¡çµ„åç¨±              | èªªæ˜ |
|-----------------------|------|
| `TAIFEXPacketParser`  | é©…å‹•æ•´é«”å°åŒ…æµç¨‹ï¼ŒåŒ…å« HeaderParser èˆ‡ Dispatcher |
| `HeaderParser`        | æ“·å–å°åŒ…æ ¼å¼ä»£ç¢¼èˆ‡æ™‚é–“ç­‰å…±é€šæ¬„ä½ |
| `PacketDispatcher`    | æ ¹æ“šæ ¼å¼ä»£è™Ÿï¼ˆå¦‚ I020ï¼‰åˆ†ç™¼è‡³å°æ‡‰ `Parser` é¡åˆ¥ |
| `I020Parser`          | æ’®åˆè³‡è¨Šæ ¼å¼ï¼ˆI020ï¼‰ä¹‹ payload è§£ç¢¼å™¨ |
| `MatchInfo`           | æ’®åˆè³‡è¨Šæ¬„ä½çµæ§‹ï¼ˆæ•¸æ“šå°æ‡‰æ¬„ä½å®šç¾©ï¼‰ |
| `TAIFEXMemoryDatabase`| å„²å­˜æ‰€æœ‰è§£æçµæœï¼Œæä¾›æŸ¥è©¢èˆ‡è¼¸å‡ºä¾†æº |
| `OutputFormatter`     | å°‡è³‡æ–™åº«çµæœè¼¸å‡ºç‚º JSON / CSV æª” |
| `DataQuery`           | æŸ¥è©¢æ¨¡çµ„ï¼Œæ”¯æ´å•†å“ä»£ç¢¼ã€æ™‚é–“å€é–“æŸ¥è©¢ç­‰ |
| `StateUpdater`        | å³æ™‚æ’®åˆç‹€æ…‹è¿½è¹¤ï¼Œå¯æ”¯æ´åœ–å½¢åŒ–é¡¯ç¤ºæ¨¡çµ„ |

---

## ğŸ“¦ å·²æ”¯æ´å°åŒ…æ ¼å¼

| æ ¼å¼ä»£ç¢¼ | å°åŒ…åç¨±           | ç‹€æ…‹     |
|----------|--------------------|----------|
| I020     | æ’®åˆè³‡è¨Š           | âœ… å·²å®Œæˆ |
| I012     | æ¼²è·Œå¹…è³‡è¨Š         | ğŸš§ é–‹ç™¼ä¸­ |
| I080     | å§”è¨—ç°¿å¿«ç…§è³‡è¨Š     | ğŸš§ é–‹ç™¼ä¸­ |
| I010     | å•†å“åŸºæœ¬è³‡è¨Š       | ğŸ•“ è¨ˆåŠƒä¸­ |

---

## ğŸ§ª åŸ·è¡Œæ–¹å¼èˆ‡æ¸¬è©¦è³‡æ–™

è«‹æ”¾ç½®æ¸¬è©¦æª”æ¡ˆæ–¼ `data/` ç›®éŒ„ï¼Œä¾‹å¦‚ï¼š

```
data/sample.bin
```

ä¸¦ä½¿ç”¨ä»¥ä¸‹æ­¥é©Ÿå»ºç½®èˆ‡åŸ·è¡Œï¼š

```bash
mkdir build && cd build
cmake ..
make
./TAIFEXMain
```

ä¸»ç¨‹å¼å°‡è®€å– `sample.bin`ã€è§£æå°åŒ…ï¼Œä¸¦è¼¸å‡ºè³‡è¨Šè‡³ console æˆ–å„²å­˜è‡³è³‡æ–™åº«ç‰©ä»¶ã€‚

---

## ğŸ“Œ æ“´å……èˆ‡å®¢è£½åŒ–è¨­è¨ˆ

æ­¤å°ˆæ¡ˆè¨­è¨ˆæ™‚å³è€ƒæ…®ï¼š

- âœ… æ”¯æ´å¤šå°åŒ…æ ¼å¼ä¸¦å¯å¿«é€Ÿæ“´å…… `parser/` èˆ‡ `data/`
- âœ… å°è£è§£æé‚è¼¯èˆ‡è³‡æ–™çµæ§‹ï¼Œæå‡é‡ç”¨æ€§èˆ‡å¯æ¸¬è©¦æ€§
- âœ… å¯ä¸²æ¥è‡³ APIã€GUI æŸ¥è©¢æ¨¡çµ„
- âœ… å¯æ“´å……ç‚ºå³æ™‚ socket ä¸²æµè§£ææ¶æ§‹ï¼ˆWIPï¼‰

---

## ğŸ“š å»¶ä¼¸æ¨¡çµ„å»ºè­°

| æ¨¡çµ„åç¨±        | åŠŸèƒ½æ§‹æƒ³                              |
|-----------------|---------------------------------------|
| `SocketReceiver`| å»ºç«‹ socket serverï¼Œè‡ªå‹•æ¥æ”¶å°åŒ…ä¸²æµ |
| `TimeSeriesDB`  | æ¥ä¸Š MongoDB / TimescaleDB å„²å­˜æ­·å²æ•¸æ“š |
| `MetricsModule` | çµ±è¨ˆæŒ‡æ¨™æ¨¡çµ„ï¼ˆå¦‚æœ€å¤§/æœ€å°/å‡å€¼ç­‰ï¼‰     |

---

## ğŸ‘¨â€ğŸ’» é–‹ç™¼è€…ç­†è¨˜

- æ‰€æœ‰è§£æçµæ§‹ç›¡é‡ç¬¦åˆ PODï¼ˆPlain Old Dataï¼‰è¨­è¨ˆï¼Œæ–¹ä¾¿è¨˜æ†¶é«” mapping èˆ‡é«˜é€Ÿè™•ç†ã€‚
- ä½¿ç”¨ `FixedArray`, `FixedString`, `TBCD` ç­‰å·¥å…·å¯¦ç¾å°åŒ…ä½å…ƒå°é½Šã€BCD ç·¨ç¢¼è™•ç†ã€‚
- å¯¦ä½œæ™‚å¯å„ªå…ˆæ¸¬è©¦å–®ä¸€æ ¼å¼ï¼ˆå¦‚ I020ï¼‰ï¼Œå†é€æ­¥æ“´å……è§£ææ”¯æ´ã€‚

---


# ğŸ“„ è¼¸å‡ºå…¥æ ¼å¼

æ­¤æ–‡ä»¶èªªæ˜æ¯å€‹å°åŒ…æ ¼å¼çš„è³‡æ–™çµæ§‹ï¼ˆå®šç¾©æ–¼ `.h` æª”æ¡ˆï¼‰å¦‚ä½•å°æ‡‰åˆ°å¯¦éš›è¼¸å‡ºçš„ CSV æ¬„ä½ã€‚

---

## âœ… I020 æ’®åˆè³‡è¨Š

### å°æ‡‰çµæ§‹ï¼š`MatchInfo`

| çµæ§‹æ¬„ä½     | CSV æ¬„ä½     | å‹æ…‹     | èªªæ˜             |
|--------------|--------------|----------|------------------|
| `matchTime`  | `time`       | int      | æˆäº¤æ™‚é–“         |
| `productId`  | `productId`  | string   | å•†å“ä»£ç¢¼         |
| `matchPrice` | `price`      | double   | æˆäº¤åƒ¹æ ¼         |
| `matchVolume`| `volume`     | int      | æˆäº¤å£æ•¸         |

---

## âœ… I012 æ¼²è·Œå¹…è³‡è¨Š

### å°æ‡‰çµæ§‹ï¼š`PriceBandInfo`

| çµæ§‹æ¬„ä½      | CSV æ¬„ä½       | å‹æ…‹   | èªªæ˜               |
|---------------|----------------|--------|--------------------|
| `productId`   | `productId`    | string | å•†å“ä»£ç¢¼           |
| `limitLevel`  | `limitLevel`   | int    | ç¬¬å¹¾éšæ¼²è·Œåœ       |
| `raiseLimit`  | `limitPrice`   | double | æ¼²åœåƒ¹æ ¼ï¼ˆå¦‚æœ‰ï¼‰   |

> å‚™è¨»ï¼šè‹¥æœ‰è·Œåœåƒ¹æ ¼ `fallLimit`ï¼Œå¯èƒ½å¦åšè¼¸å‡ºæˆ–åˆä½µé¡¯ç¤ºã€‚

---

## âœ… I080 å§”è¨—ç°¿å¿«ç…§ï¼ˆç°¡åŒ–è¼¸å‡ºï¼‰

### å°æ‡‰çµæ§‹ï¼š`OrderBookInfo`

| çµæ§‹æ¬„ä½         | CSV æ¬„ä½         | å‹æ…‹     | èªªæ˜         |
|------------------|------------------|----------|--------------|
| `updateTime`     | `time`           | int      | è³‡æ–™æ™‚é–“     |
| `productId`      | `productId`      | string   | å•†å“ä»£ç¢¼     |
| `bidPrice[0]`    | `bidPrice1`      | double   | ç¬¬ä¸€æª”è²·åƒ¹   |
| `bidVolume[0]`   | `bidVolume1`     | int      | ç¬¬ä¸€æª”è²·é‡   |
| `askPrice[0]`    | `askPrice1`      | double   | ç¬¬ä¸€æª”è³£åƒ¹   |
| `askVolume[0]`   | `askVolume1`     | int      | ç¬¬ä¸€æª”è³£é‡   |

> å‚™è¨»ï¼šç°¡åŒ–ç‰ˆæœ¬åƒ…è¼¸å‡ºç¬¬ä¸€æª”ï¼Œå®Œæ•´ç‰ˆæœ¬å¯ä¾éœ€æ±‚å±•é–‹ bid/ask 1~5ã€‚

---

## âœ… I010 å•†å“åŸºæœ¬è³‡è¨Š

### å°æ‡‰çµæ§‹ï¼š`ProductInfo`

| çµæ§‹æ¬„ä½        | CSV æ¬„ä½        | å‹æ…‹       | èªªæ˜         |
|-----------------|-----------------|------------|--------------|
| `productId`     | `productId`     | string     | å•†å“ä»£ç¢¼     |
| `productName`   | `name`          | string     | å•†å“åç¨±     |
| `deliveryMonth` | `deliveryMonth` | string/int | äº¤å‰²æœˆä»½     |

---



### ğŸ“‚ è¼¸å‡ºæª”æ¡ˆä½ç½®

```
output/
â”œâ”€â”€ I020.csv
â”œâ”€â”€ I012.csv
â”œâ”€â”€ I080.csv
â””â”€â”€ I010.csv
```

ä½¿ç”¨ä»¥ä¸‹å‡½å¼åŒ¯å‡ºï¼š

```cpp
OutputFormatter::exportToCSV(database, "output/");
```